# initiate_auth_code_flow の仕組み

`initiate_auth_code_flow` は、Webアプリなどでユーザーごとに認証を行いたい場合に使う認証フロー。
この関数を使うと、自分で認証用のURLを生成し、ユーザーに表示できる。
ユーザーがそのURLで認証を行うと、指定したリダイレクト先（例: `http://localhost:8501` や自分のWebアプリのURL）に認証コード（`code`）がクエリパラメータとして付与されて返ってくる。

## 基本的な流れ

1. `initiate_auth_code_flow` で認証用のURLを生成する。
2. そのURLをユーザーに表示し、認証してもらう。
3. 認証が終わると、リダイレクト先に `code` パラメータ付きでリクエストが来る。
4. その `code` を使って `acquire_token_by_auth_code_flow` でトークンを取得する。

## 注意点

- 認証後の `code` はリダイレクト先のURLのクエリパラメータとして渡される。
  そのため、Webアプリ側でURLから `code` をパースして取得する必要がある。
  この処理が少し面倒になることがある。
- Microsoft公式のクライアントID（`51f81489-12ee-4a9e-aaae-a2591f45987d`）はテスト用で、実際に自分のAPIにアクセスしようとすると `AADSTS65002` エラーになる。
  本番環境ではAzureポータルで自分専用のアプリ登録を作成し、そのクライアントIDを使う必要がある。

## まとめ

- `initiate_auth_code_flow` はWebアプリなどでユーザーごとに認証させたい場合に使う。
- 認証後はリダイレクト先のURLに `code` がクエリパラメータとして付与されるので、これを取得してトークン取得処理に進む。
- 本番運用では自分のアプリ登録のクライアントIDを使うこと。